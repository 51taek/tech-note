## 마이크로서비스(Microservices)

### 1. 서비스(Service)란?

미리 정의된 인터페이스를 사용해 **하나 이상의 역량에 접근하기 위한 메커니즘**을 의미한다.

> 💡 **미리 정의된 인터페이스란?**  
> 서비스로부터 **데이터를 넣고 빼는 모든 메커니즘**을 의미한다.  
> (예: REST API, gRPC API, 메시지 큐, 이벤트, RPC 등)

---

### 2. 마이크로서비스(Microservice)의 개념

- 서비스는 **자신의 퍼블릭 인터페이스**로 정의되므로, 마이크로서비스도 자신의 **마이크로 퍼블릭 인터페이스(마이크로 프론트 도어)**로 정의된다.
- 퍼블릭 인터페이스가 명확하면 단일 서비스 기능뿐 아니라, 그 서비스가 연동하는 다른 시스템 구성 요소들도 쉽게 이해할 수 있다.
- 시스템은 완전히 독립적인 컴포넌트로 구성될 수 없다.
- 설계 관점에서 **로컬 복잡성과 글로벌 복잡성은 반비례 관계**이다.

---

### 3. 깊은 모듈로서의 마이크로서비스

- 시스템의 복잡성 관점에서, **깊은 모듈**은 시스템의 **글로벌 복잡성을 줄여주고**,  
  반대로 **얕은 모듈**은 로컬 복잡성을 감싸지 못해 결과적으로 글로벌 복잡성을 증가시킨다.
- **얕은 서비스**는 많은 마이크로서비스 프로젝트가 실패하는 원인이 된다.
- 서비스의 코드 길이를 인위적으로 제한하는(예: "X줄 이상의 서비스 금지") 방식은 잘못된 접근이다.
- 마이크로서비스를 과도하게 분해하면, 인터페이스가 너무 많아져 **분산된 커다란 진흙 덩어리(Big Ball of Mud)**가 된다.

---

### 4. 도메인 주도 설계(DDD)와 마이크로서비스 경계

- 마이크로서비스는 **바운디드 컨텍스트(Bounded Context)**로 볼 수 있지만,  
  **모든 바운디드 컨텍스트가 마이크로서비스가 되는 것은 아니다.**
- 애그리게이트의 경계는 가능한 한 좁게 설정한다.
- 애그리게이트와 동일 하위 도메인의 다른 엔티티 간 관계가 강하면 **얕은 서비스가 되기 쉽다.**
- 가장 균형 잡힌 휴리스틱은  
  **비즈니스 하위 도메인의 경계를 기반으로 서비스를 나누는 것**이다.
- 하위 도메인이 **“무엇을 하는지(What)”** 중심으로 정의될수록 자연스럽게 **깊은 모듈**이 된다.
- 유스케이스를 너무 작은 단위로 분리하면 퍼블릭 인터페이스가 복잡해지고 모듈은 얕아진다.
- 즉, **하위 도메인 단위로 마이크로서비스를 구성하는 것이 일반적으로 최적의 방법**이다.

---

### 5. 마이크로서비스의 퍼블릭 인터페이스 압축(Interface Compression)

#### 5-1. 오픈 호스트 서비스(Open Host Service, OHS)

- 바운디드 컨텍스트 내부 모델을 외부 시스템과 연동하는 데 사용하는 모델과 **분리**해준다.
- **장점**
  - 글로벌 복잡성을 줄여준다.
  - 제한된 모델을 외부에 노출하여 **내부 구현 복잡성을 숨긴다.**
- 결과적으로 **퍼블릭 인터페이스가 단순해지고**,  
  서비스는 더 **깊은 모듈**이 되어 효과적인 마이크로서비스 설계에 기여한다.

#### 5-2. 충돌 방지 계층(Anti-Corruption Layer, ACL)

- 다른 바운디드 컨텍스트와 연동할 때 발생하는 복잡성을 줄여준다.
- **장점**
  - 로컬 복잡성과 글로벌 복잡성을 모두 낮춘다.
  - 외부 연동 복잡성은 ACL이 모두 흡수한다.

---

### 📌 요약

- 마이크로서비스는 **퍼블릭 인터페이스 중심**으로 정의된다.
- **깊은 서비스 = 글로벌 복잡성 감소 / 얕은 서비스 = 실패로 가는 길**
- DDD의 **하위 도메인 경계**를 기준으로 마이크로서비스를 설계하는 것이 최적.
- 오픈 호스트 서비스(OHS)와 ACL을 통해 퍼블릭 인터페이스를 **압축**하면  
  더 깊고 안정적인 마이크로서비스 구조를 만들 수 있다.

